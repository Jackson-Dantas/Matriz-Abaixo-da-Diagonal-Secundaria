const {is_high_surrogate} = require("./decd-def");

const _char_freq_if_u16 = (s,one)=> {
    let len  = s.length;
    let cnt  = 0;
    let i    = 0;
	let code = -1;
	while(true) {
	   if(i>=len){
	       break;
	   } else {
	       code = s[i].charCodeAt(0)
	       if(is_high_surrogate(code)) {
	           ++i;++i;
	       } else {
	           if(code===one) {
		           ++cnt;
		       } else {
		       }
		       ++i;
	       }
	   }
	}
	return(cnt);
}


const _char_freq_if_u16u16 = (s,high,low)=> {
    let len  = s.length;
    let cnt  = 0;
    let i    = 0;
	let code = -1;
	while(true) {
	   if(i>=len){
	       break;
	   } else {
	       code = s[i].charCodeAt(0);
	       if(is_high_surrogate(code)) {
	           if(code === high) {
			        code = s[i+1].charCodeAt(0)
			        if(code === low) {
					    ++cnt;
					} else {
					}
			   } else {
			   }
			   ++i;++i;
	       } else {
		       ++i;
	       }
	   }
	}
	return(cnt);
}


const _parse_char = (ch)=> {
     let maybe_high = ch.charCodeAt(0);
     if(is_high_surrogate(maybe_high)) {
         return([maybe_high,ch.charCodeAt(1)])
     } else {
         return([maybe_high,-1])
     }
}

const char_freq = (s,ch) => {
    let [high,low] = _is_u16u16_char(ch);
    if(low != -1) {
        return(_char_freq_if_u16u16(s,high,low));
    } else {
        return(_char_freq_if_u16(s,high));
    }
}



module.exports = {
    _char_freq_if_u16,
    _char_freq_if_u16u16,
    _parse_char,
    char_freq,
}

